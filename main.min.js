const querystring=window.location.search,urlParams=new URLSearchParams(querystring),validpaths={"bmF1Y3p5Y2llbA==":[["grupa 1","grupa 2"],"grupa 2"],"OTIwNzk4NDY=":[["grupa 1","grupa 2"],"grupa 1"],"OTc3NjE3Njg=":[["grupa 1","grupa 2"],"grupa 1"],"MTU2NDkzODQ=":[["grupa 1","grupa 2","Zerom 2A"],"grupa 1"],"MzY0NjQ0OTU=":[["grupa 1","grupa 2"],"grupa 1"],"MzIyMDIzODk=":[["grupa 1","grupa 2"],"grupa 1"],"NzA2NTkxODQ=":[["grupa 1","grupa 2"],"grupa 2"],"OTkyMTg2NDA=":[["grupa 1","grupa 2"],"grupa 2"],"NjE4Mzg3Nzk=":[["grupa 1","grupa 2"],"grupa 2"],"Mjc0NTcxNDU=":[["Zerom 2A"],"Zerom 2A"],"OTQyOTYxNDk=":[["grupa 1","grupa 2"],"grupa 2"]},plans={"grupa 1":{startingHour:[8,0],lessonSpan:45,breaks:[5,10,15,5,5,10,5,5],lessons:[{"Poniedziałek":[["Fizyka",16],["Chemia",43],["Geografia",32],["Wychowaw.",38],["Matma",16],["Matma",16],["Historia",15],["Religia",33],[null,0]]},{Wtorek:[["Polski","n/a"],["Polski","n/a"],["Biologia",27],["Matma",16],["Angielski",14],["Niemiecki",11],["Informatyka",31],["Informatyka",31],[null,0]]},{"Środa":[[null,0],[null,0],["Fizyka",17],["Historia",34],["Niemiecki",11],["WOS",17],["Chemia",43],["Religia",17],[null,0]]},{Czwartek:[["Biologia",42],["Geografia",32],["Matma",16],["Matma",16],["Polski",34],["WF","sala"],["WF","sala"],["Angielski",40],[null,0]]},{"Piątek":[[null,0],["WF","sala"],["Angielski",38],["Polski",34],["Fizyka",15],["Matma",16],["Podst. Przed.",33],[null,0],[null,0]]}]},"grupa 2":{startingHour:[8,0],lessonSpan:45,breaks:[5,10,15,5,5,10,5,5],lessons:[{"Poniedziałek":[["Fizyka",16],["Chemia",43],["Geografia",32],["Wychowaw.",38],["Matma",16],["Matma",16],["Historia",15],["Religia",33],[null,0]]},{Wtorek:[["Polski","n/a"],["Polski","n/a"],["Biologia",27],["Matma",16],["Angielski",17],["Informatyka",31],["WF","sala"],["WF","sala"],[null,0]]},{"Środa":[[null,0],["Informatyka",31],["Fizyka",17],["Historia",34],["Angielski",31],["WOS",17],["Chemia",43],["Religia",17],[null,0]]},{Czwartek:[["Biologia",42],["Geografia",32],["Matma",16],["Matma",16],["Polski",34],["Angielski",5],["Niemiecki",11],["WF","sala"],[null,0]]},{"Piątek":[[null,0],[null,0],["Niemiecki",11],["Polski",34],["Fizyka",15],["Matma",16],["Podst. Przed.",33],[null,0],[null,0]]}]},"Zerom 2A":{startingHour:[8,0],lessonSpan:45,breaks:[5,10,15,5,10,5,5,5],lessons:[{"Poniedziałek":[["Podst. Przed.",87],["Matematyka",61],["Polski",56],["Polski",56],["WF","sala"],["WOS",62],["Geografia",67],["Chemia",71],[null,0]]},{Wtorek:[["Angielski",77],["Biologia",70],["Historia",85],["Historia",85],["Chemia",71],["Informatyka",46],["Polski",56],[null,0],[null,0]]},{"Środa":[["Fizyka",85],["WF","sala"],["WF","sala"],["Polski",56],["Polski",56],["Wychow.",92],["WOS",62],[null,0],[null,0]]},{Czwartek:[["Niemiecki",92],["Angielski",77],["Biologia",70],[null,0],["Matematyka",61],["Polski",56],["Historia",85],[null,0],[null,0]]},{"Piątek":[["Geografia",67],[null,0],["WOS",62],["Niemiecki",92],["Angielski",77],["Matematyka",61],["Matematyka",61],[null,0],[null,0]]}]}},isNotAuth=null==validpaths[btoa(urlParams.get("id"))],planIdSpan=document.querySelector("#plan_id"),timeNowSpan=document.querySelector("#time_now"),currentLessonSpan=document.querySelector("#current_lesson"),nextLessonSpan=document.querySelector("#next_lesson"),changePlanSelect=document.querySelector("#switch_plan"),timeTillBreakSpan=document.querySelector("#time_till_break"),isTeacher="bmF1Y3p5Y2llbA=="===btoa(urlParams.get("id")),zeroSecMilsec=dateObj=>{dateObj.setSeconds(0),dateObj.setMilliseconds(0)};if(isNotAuth)timeNowSpan.textContent="-",currentLessonSpan.textContent="-",nextLessonSpan.textContent="-",timeTillBreakSpan.textContent="-",changePlanSelect.style.display="none",document.querySelector(".wrap").textContent="Nieautoryzowany dostęp!";else{const userPlans=validpaths[btoa(urlParams.get("id"))][0];let activePlan=validpaths[btoa(urlParams.get("id"))][1];const generateHourArray=(startingHour,breaks,lessonSpan)=>{let hours=[];return breaks.forEach((item,index)=>{let date=new Date;if(date.setHours(startingHour[0]),date.setMinutes(startingHour[1]),index>0){const breaksThatPassed=breaks.slice(0,index);let sum=0;breaksThatPassed.forEach(breakThatPassed=>{sum+=breakThatPassed}),date.setMinutes(date.getMinutes()+sum+(lessonSpan*index+1)-1)}hours.push([date.getHours(),date.getMinutes(),index])}),hours},renderTable=plan=>{if(isNotAuth)return;planLekcji.innerHTML="";const{breaks:breaks,lessonSpan:lessonSpan,startingHour:startingHour,lessons:lessons}=plans[plan],rows=[document.createElement("tr")],hourArray=generateHourArray(startingHour,breaks,lessonSpan);breaks.forEach(item=>{rows.push(document.createElement("tr"))});const colAmt=lessons.length+1;rows.forEach((row,index)=>{if(0===index)for(let i=0;i<colAmt;i++)if(0===i){const cell=document.createElement("th");cell.textContent=isTeacher?"Plan":"Trzmielarz",row.appendChild(cell)}else{const cell=document.createElement("th");cell.textContent=Object.keys(lessons[i-1])[0],cell.classList.add(Object.keys(lessons[i-1])[0]),cell.classList.add("day"),row.appendChild(cell)}else for(let i=0;i<colAmt;i++)if(0===i){const cell=document.createElement("td");cell.classList.add(`hr_${index}`),cell.classList.add("hr");const lessonStartDate=new Date;lessonStartDate.setHours(hourArray[index-1][0]),lessonStartDate.setMinutes(hourArray[index-1][1]);const lessonEndDate=new Date(lessonStartDate.getTime()+6e4*lessonSpan),startHours=lessonStartDate.getHours();let startMintues=lessonStartDate.getMinutes();startMintues=1==String(startMintues).length?"0"+startMintues:startMintues;const endHours=lessonEndDate.getHours();let endMinutes=lessonEndDate.getMinutes();endMinutes=1==String(endMinutes).length?"0"+endMinutes:endMinutes,cell.textContent=`${startHours}:${startMintues} - ${endHours}:${endMinutes}`,row.appendChild(cell)}else{const cell=document.createElement("td");cell.classList.add(`${Object.keys(lessons[i-1])[0]}_${index}`),cell.classList.add("lesson"),cell.classList.add(`${Object.keys(lessons[i-1])[0]}_lesson`),cell.dataset.classroomId=lessons[i-1][Object.keys(lessons[i-1])[0]][index-1][1],cell.dataset.lesson=lessons[i-1][Object.keys(lessons[i-1])[0]][index-1][0],cell.dataset.displayingNow="lesson",cell.textContent=lessons[i-1][Object.keys(lessons[i-1])[0]][index-1][0],row.appendChild(cell)}}),rows.forEach(row=>{planLekcji.appendChild(row)})},planLekcji=document.getElementById("plan"),planIdSpan=document.querySelector("#plan_id"),timeNowSpan=document.querySelector("#time_now"),currentLessonSpan=document.querySelector("#current_lesson"),nextLessonSpan=document.querySelector("#next_lesson"),changePlanSelect=document.querySelector("#switch_plan"),timeTillBreakSpan=document.querySelector("#time_till_break");planIdSpan.textContent=`${btoa(urlParams.get("id"))} : ${activePlan}`,renderTable(activePlan);const updateCurrentLesson=()=>{if(isNotAuth)return;const todayDate=new Date;timeNowSpan.textContent=`${todayDate.getHours()}:${todayDate.getMinutes()>9?todayDate.getMinutes():"0"+todayDate.getMinutes()}:${todayDate.getSeconds()>9?todayDate.getSeconds():"0"+todayDate.getSeconds()}`;const day=todayDate.getDay(),hour=todayDate.getHours(),minute=todayDate.getMinutes(),nextLessonStartingTime=new Date,isWeekend=6===day||0===day;let timeUntilNextLesson;if(isWeekend)currentLessonSpan.textContent="Weekend!",nextLessonSpan.textContent="-";else{let todayLessons=plans[activePlan].lessons[day-1];const nameOfTheDay=Object.keys(todayLessons)[0];let dateObjects=[],isBreak=!1;todayLessons=todayLessons[Object.keys(todayLessons)[0]];const hourArray=generateHourArray(plans[activePlan].startingHour,plans[activePlan].breaks,plans[activePlan].lessonSpan);hourArray.forEach(timeSet=>{newDate=new Date,newDate.setHours(timeSet[0]),newDate.setMinutes(timeSet[1]),timeSet[0]<hour?dateObjects.push([newDate.getTime(),timeSet[2]]):timeSet[0]===hour&&timeSet[1]<=minute&&dateObjects.push([newDate.getTime(),timeSet[2]])}),dateObjects=dateObjects.map(dObj=>[dObj[0]-todayDate.getTime(),dObj[1]]);let min=[null,-1];for(let i=0;i<dateObjects.length;i++)(null===min[0]||Math.abs(dateObjects[i][0])<min[0])&&(min=[Math.abs(dateObjects[i][0]),dateObjects[i][1]]);const currentLessonStartingTime=new Date;-1===min[1]||(currentLessonStartingTime.setHours(hourArray[min[1]][0]),currentLessonStartingTime.setMinutes(hourArray[min[1]][1])),currentLessonStartingTime.setSeconds(0),currentLessonStartingTime.setMilliseconds(0);const timeFromLastLesson=currentLessonStartingTime.getTime()-Date.now(),timeFromLastLessonMinutes=Math.abs(timeFromLastLesson/6e4);timeFromLastLessonMinutes>=plans[activePlan].lessonSpan?(currentLessonSpan.textContent="Przerwa!",isBreak=!0):null===todayLessons[min[1]]?currentLessonSpan.textContent="-":-1===min[1]?currentLessonSpan.textContent="Przed lekcjami!":currentLessonSpan.textContent=todayLessons[min[1]][0];let lessonsTodayReverse=Array.from(todayLessons).reverse(),lessonsTodayNoNullAtEnd;lessonsTodayReverse.forEach((item,index)=>{null!==item[0]&&(lessonsTodayNoNullAtEnd=lessonsTodayReverse.splice(index).reverse())});const amtOfLessonsToday=lessonsTodayNoNullAtEnd.length,lastLesson=hourArray[amtOfLessonsToday-1],lastLessonStartingTime=new Date;lastLessonStartingTime.setHours(lastLesson[0]),lastLessonStartingTime.setMinutes(lastLesson[1]),zeroSecMilsec(lastLessonStartingTime);const lastLessonEndingTime=new Date(lastLessonStartingTime.getTime()+6e4*plans[activePlan].lessonSpan);lastLessonEndingTime.getTime()<=Date.now()?(currentLessonSpan.textContent="Chata!",nextLessonSpan.textContent="-",timeUntilNextLesson=null):lastLessonStartingTime.getTime()<=Date.now()?(nextLessonSpan.textContent="Chata",timeUntilNextLesson=null):(null===todayLessons[min[1]+1][0]?nextLessonSpan.textContent="-":nextLessonSpan.textContent=todayLessons[min[1]+1][0],nextLessonStartingTime.setHours(hourArray[min[1]+1][0]),nextLessonStartingTime.setMinutes(hourArray[min[1]+1][1]),zeroSecMilsec(nextLessonStartingTime),timeUntilNextLesson=nextLessonStartingTime.getTime()-Date.now());const timeTillBreak=plans[activePlan].lessonSpan-timeFromLastLessonMinutes;if(timeTillBreak>0){const helper=new Date(timeUntilNextLesson);-1===min[1]?helper.getHours()-1==0?timeTillBreakSpan.textContent=`Do lekcji: ${helper.getMinutes()+1} min.`:timeTillBreakSpan.textContent=`Do lekcji: ${helper.getHours()-1} godz. ${helper.getMinutes()+1} min.`:timeTillBreakSpan.textContent=`Do przerwy: ${Math.ceil(timeTillBreak)} min.`}else if(null!==timeUntilNextLesson){const helper=new Date(timeUntilNextLesson);helper.getHours()-1==0?timeTillBreakSpan.textContent=`Do lekcji: ${helper.getMinutes()+1} min.`:timeTillBreakSpan.textContent=`Do lekcji: ${helper.getHours()-1} godz. ${helper.getMinutes()+1} min.`}else timeTillBreakSpan.textContent="Na nic nie czekasz!";let offset=isBreak?2:1;const dayCells=document.querySelectorAll(".day");dayCells.forEach(cell=>{cell.classList.contains(nameOfTheDay)?cell.classList.add("active"):cell.classList.remove("active")});const lessonsOfTheDay=document.querySelectorAll(`.${nameOfTheDay}_lesson`);lessonsOfTheDay.forEach((lesson,index)=>{-1!==min[1]?lesson.classList.contains(`${nameOfTheDay}_${min[1]+offset}`)?2===offset?lesson.classList.add("awaiting"):lesson.classList.add("active"):(lesson.classList.remove("awaiting"),lesson.classList.remove("active")):0===index?lesson.classList.add("awaiting"):lesson.classList.remove("awaiting")});const hourCells=document.querySelectorAll(".hr");hourCells.forEach((cell,index)=>{-1!==min[1]?cell.classList.contains(`hr_${min[1]+offset}`)?2===offset?cell.classList.add("awaiting"):cell.classList.add("active"):(cell.classList.remove("awaiting"),cell.classList.remove("active")):0===index?cell.classList.add("awaiting"):cell.classList.remove("awaiting")})}},addShowClassroomIdHandlers=()=>{document.querySelectorAll(".lesson").forEach(el=>{el.addEventListener("click",()=>{""!=el.textContent&&("lesson"===el.dataset.displayingNow?(el.dataset.displayingNow="classroomId",el.textContent=el.dataset.classroomId):(el.dataset.displayingNow="lesson",el.textContent=el.dataset.lesson))})})};userPlans.forEach(planName=>{let option=document.createElement("option");option.value=planName,option.textContent=planName,changePlanSelect.appendChild(option)}),changePlanSelect.addEventListener("change",e=>{console.log(e.target.value),activePlan=e.target.value,planIdSpan.textContent=`${btoa(urlParams.get("id"))} : ${activePlan}`,renderTable(activePlan)}),changePlanSelect.value=activePlan,setInterval(updateCurrentLesson,1e3),addShowClassroomIdHandlers()}