const plans={"grupa 1":{startingHour:[8,0],lessonSpan:45,breaks:[5,10,15,5,5,10,5,5],lessons:[{"Poniedziałek":[null,null,"Angielski","Wychowaw.","Historia","Matma","Filozofia","Religia",null]},{Wtorek:[null,null,"WOS","Matma","EDB","Polski","Polski",null,null]},{"Środa":["Angielski","Matma","Chemia","Fizyka","Historia","Informatyka","Niemiecki",null,null]},{Czwartek:["Angielski","Matma","Biologia","Polski","Religia","WF","Informatyka","Niemiecki",null]},{"Piątek":["Angielski","Matma","Fizyka","Geografia","Polski","WF","WF",null,null]}]},"grupa 2":{startingHour:[8,0],lessonSpan:45,breaks:[5,10,15,5,5,10,5,5,5],lessons:[{"Poniedziałek":[null,null,"Angielski","Wychowaw.","Historia","Matma","Filozofia","Religia",null]},{Wtorek:[null,null,"WOS","Matma","EDB","Polski","Polski","WF","WF"]},{"Środa":["WF","Matma","Chemia","Angielski","Historia","Niemiecki","Informatyka",null,null]},{Czwartek:[null,"Matma","Biologia","Polski","Religia","Fizyka","Niemiecki","Informatyka",null]},{"Piątek":[null,"Matma","Fizyka","Geografia","Polski","Angielski","Angielski",null,null]}]}},generateHourArray=(e,t,n)=>{let s=[];return t.forEach((a,l)=>{let o=new Date;if(o.setHours(e[0]),o.setMinutes(e[1]),l>0){const e=t.slice(0,l);let s=0;e.forEach(e=>{s+=e}),o.setMinutes(o.getMinutes()+s+(n*l+1)-1)}s.push([o.getHours(),o.getMinutes(),l])}),s},renderTable=e=>{planLekcji.innerHTML="";const{breaks:t,lessonSpan:n,startingHour:s,lessons:a}=e,l=[document.createElement("tr")],o=generateHourArray(s,t,n);t.forEach(e=>{l.push(document.createElement("tr"))});const i=a.length+1;l.forEach((e,t)=>{if(0===t)for(let t=0;t<i;t++)if(0===t){const t=document.createElement("th");t.textContent="Trzmielarz",e.appendChild(t)}else{const n=document.createElement("th");n.textContent=Object.keys(a[t-1])[0],n.classList.add(Object.keys(a[t-1])[0]),n.classList.add("day"),e.appendChild(n)}else for(let s=0;s<i;s++)if(0===s){const s=document.createElement("td");s.classList.add(`hr_${t}`),s.classList.add("hr");const a=new Date;a.setHours(o[t-1][0]),a.setMinutes(o[t-1][1]);const l=new Date(a.getTime()+6e4*n),i=a.getHours();let r=a.getMinutes();r=1==String(r).length?"0"+r:r;const c=l.getHours();let u=l.getMinutes();u=1==String(u).length?"0"+u:u,s.textContent=`${i}:${r} - ${c}:${u}`,e.appendChild(s)}else{const n=document.createElement("td");n.classList.add(`${Object.keys(a[s-1])[0]}_${t}`),n.classList.add(`${Object.keys(a[s-1])[0]}_lesson`),n.textContent=a[s-1][Object.keys(a[s-1])[0]][t-1],e.appendChild(n)}}),l.forEach(e=>{planLekcji.appendChild(e)})};let renderedTable="grupa 1";const planLekcji=document.getElementById("plan"),planIdSpan=document.querySelector("#plan_id"),timeNowSpan=document.querySelector("#time_now"),currentLessonSpan=document.querySelector("#current_lesson"),nextLessonSpan=document.querySelector("#next_lesson"),changeButton=document.querySelector("#switch_plan"),timeTillBreakSpan=document.querySelector("#time_till_break");planIdSpan.textContent=renderedTable,renderTable(plans[renderedTable]);const updateCurrentLesson=()=>{const e=plans[renderedTable],t=new Date;timeNowSpan.textContent=`${t.getHours()}:${t.getMinutes()>9?t.getMinutes():"0"+t.getMinutes()}:${t.getSeconds()>9?t.getSeconds():"0"+t.getSeconds()}`;const n=t.getDay(),s=t.getHours(),a=t.getMinutes(),l=new Date,o=6===n||7===n;let i;if(o)currentLessonSpan.textContent="Weekend!",nextLessonSpan.textContent="-";else{let o=e.lessons[n-1];const r=Object.keys(o)[0];let c=[],u=!1;o=o[Object.keys(o)[0]];const d=generateHourArray(e.startingHour,e.breaks,e.lessonSpan);d.forEach(e=>{newDate=new Date,newDate.setHours(e[0]),newDate.setMinutes(e[1]),e[0]<s?c.push([newDate.getTime(),e[2]]):e[0]===s&&e[1]<=a&&c.push([newDate.getTime(),e[2]])}),c=c.map(e=>[e[0]-t.getTime(),e[1]]);let g=[null,-1];for(let e=0;e<c.length;e++)(null===g[0]||Math.abs(c[e][0])<g[0])&&(g=[Math.abs(c[e][0]),c[e][1]]);const m=new Date;m.setHours(d[g[1]][0]),m.setMinutes(d[g[1]][1]),m.setSeconds(0),m.setMilliseconds(0);const p=m.getTime()-Date.now(),k=Math.abs(p/6e4);k>=e.lessonSpan?(currentLessonSpan.textContent="Przerwa!",u=!0):null===o[g[1]]?currentLessonSpan.textContent="-":currentLessonSpan.textContent=o[g[1]];let S,h=Array.from(o).reverse();h.forEach((e,t)=>{null!==e&&(S=h.splice(t).reverse())});const y=S.length,L=d[y-1],C=new Date;C.setHours(L[0]),C.setMinutes(L[1]),C.setSeconds(0),C.setMilliseconds(0);const M=new Date(C.getTime()+6e4*e.lessonSpan);console.log(C),M.getTime()<=Date.now()?(currentLessonSpan.textContent="Chata!",nextLessonSpan.textContent="-",i=null):C.getTime()<=Date.now()?(nextLessonSpan.textContent="Chata",i=null):(null===o[g[1]+1]?nextLessonSpan.textContent="-":nextLessonSpan.textContent=o[g[1]+1],l.setHours(d[g[1]+1][0]),l.setMinutes(d[g[1]+1][1]),l.setSeconds(0),l.setMilliseconds(0),i=l.getTime()-Date.now());const w=e.lessonSpan-k;if(w>0)console.log(w),timeTillBreakSpan.textContent=`Do przerwy: ${Math.ceil(w)} min.`;else if(null!==i){const e=new Date(i);timeTillBreakSpan.textContent=`Do lekcji: ${e.getMinutes()+1} min.`}else timeTillBreakSpan.textContent="Na nic nie czekasz!";let f=u?2:1;const x=document.querySelectorAll(".day");x.forEach(e=>{e.classList.contains(r)?e.classList.add("active"):e.classList.remove("active")});const b=document.querySelectorAll(`.${r}_lesson`);b.forEach(e=>{e.classList.contains(`${r}_${g[1]+f}`)?e.classList.add("active"):e.classList.remove("active")});const T=document.querySelectorAll(".hr");T.forEach(e=>{e.classList.contains(`hr_${g[1]+f}`)?e.classList.add("active"):e.classList.remove("active")})}};changeButton.addEventListener("click",()=>{renderedTable="grupa 1"===renderedTable?"grupa 2":"grupa 1",renderTable(plans[renderedTable]),updateCurrentLesson(),planIdSpan.textContent=renderedTable}),setInterval(updateCurrentLesson,1e3);